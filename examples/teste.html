<html>
<head>
<script src="juice.js"></script>

<script>

// ADDS METHODS TO BE EXECUTED AFTER PAGE LOADING
//juice.events.onload.add(do_get);
//juice.events.onload.add(do_post);
//juice.events.onload.add(text);
//juice.events.onload.add(testArrayFunc);
//juice.events.onload.add(paramsBuilder);

// ADDS SOME KEYBOARD EVENTS
juice.events.key.handleKeys();
juice.events.key.add("A", function(){document.getElementById("divtest1").innerHTML+="a";});
juice.events.key.add("B", function(){document.getElementById("divtest1").innerHTML+="b";});
juice.events.key.left(function(){alert("left")});
juice.events.key.up(function(){alert("up")});
juice.events.key.down(function(){alert("down")});
juice.events.key.right(function(){alert("turning off"); juice.events.key.unhandleKeys();});

sched = new juice.rpc.AjaxScheduler("teste.xml",
					 {response: response_handler,
					 delay: 10000});

//sched.start();


sched2 = new juice.rpc.AjaxScheduler("teste.xml",
					 {response: response_handler2,
					 delay: 7000});

//sched2.start();


// CREATES A NEW AJAX OBJECT
//var good_adress_ajax = new juice.rpc.Ajax("teste.xml", response_handler, error_handler);

//juice.rpc.get("teste.xml", "as=2", response_handler, error_handler);
//juice.rpc.post("teste.xml", "bes=2", response_handler, error_handler);
//juice.rpc.send("teste.xml", "as=2");

juice.html.updateBlockContent("teste.xml", "", "divtest1");

function response_handler(req){
	sb = new juice.text.StringBuffer();
	sb.append("OK:");
	sb.append("resposta txt::"+req.text());
	sb.append("resposta xml::"+req.xml());
	sb.append("resposta json::"+req.json());
	sb.append("resposta status::"+req.statusText());
	sb.append("resposta status code::"+req.statusCode());
	sb.append("resposta obj::"+req.responseObject());
	alert(sb.concat('\n'));
}

function response_handler2(req){
	sb = new juice.text.StringBuffer();
	sb.append("OK 2:");
	sb.append("resposta txt::"+req.text());
	sb.append("resposta xml::"+req.xml());
	sb.append("resposta json::"+req.json());
	sb.append("resposta status::"+req.statusText());
	sb.append("resposta status code::"+req.statusCode());
	sb.append("resposta obj::"+req.responseObject());
	alert(sb.concat('\n'));
}


function error_handler(req){
	sb = new juice.text.StringBuffer();
	sb.append("ERROR:");
	sb.append('\n');
	sb.append("resposta txt::"+req.text());
	sb.append('\n');
	sb.append("resposta xml::"+req.xml());
	sb.append('\n');
	sb.append("resposta json::"+req.json());
	sb.append('\n');
	sb.append("resposta status::"+req.statusText());
	sb.append('\n');
	sb.append("resposta status code::"+req.statusCode());
	sb.append('\n');
	sb.append("resposta obj::"+req.requestObject());
	sb.append('\n');
	alert(sb.toString());
}

// EXECUTES A POST CALL
function do_post(){
	good_adress_ajax.post();
}


// EXECUTES A GET CALL
function do_get(){
	good_adress_ajax.get();
}

// EXECUTES STRIP FUNCTIONS
function text(){
	var a = "   ddfdsfdsf  "
	alert("rstrip#"+a.rstrip()+"#");
	alert("lstrip#"+a.lstrip()+"#");
	alert("fstrip#"+a.fstrip()+"#");
}

function paramsBuilder(){
	dict = {nome:"miguel", idade:"26", resumo:"isso e um teste do encode oks ?"};
	alert(juice.rpc.buildRequestStr(dict));
	alert(juice.data.dictKeys(dict));
	alert(juice.data.dictValues(dict));
}


function testArrayFunc(){
	var array = [1, 2, 3, 4, 5];
	try{
		alert(array.map(function(x){return x+x;}));
		alert(array);
		alert(array.filter(function(x){return (x%3==0);}));
		alert(array.reduce(function(x, y){return x+y;}));
	}catch(e){
		alert(e);
	}
}

</script>

</head>
<body>
<div id="divtest1"></div></body>